// üìÑ ARCHIVO: prisma/schema.prisma
// üîß Esquema de base de datos - VERIFICAR QUE COINCIDA

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model inspecciones {
  id                   String   @id @default(cuid())
  
  // üéØ CAMPOS OBLIGATORIOS - CR√çTICOS
  placa_vehiculo       String   // ‚ö†Ô∏è NO PUEDE SER NULL
  contrato             String   // ‚ö†Ô∏è NO PUEDE SER NULL  
  turno                String   // ‚ö†Ô∏è NO PUEDE SER NULL
  conductor_nombre     String   @default("")
  fecha                DateTime @default(now())
  
  // üìä CAMPOS DE CONTEXTO
  campo_coordinacion   String   @default("")
  kilometraje          Int      @default(0)
  marca_temporal       BigInt   @default(0)
  
  // üìã CAMPOS DE EVALUACI√ìN
  nivel_riesgo         String   @default("BAJO")
  puntaje_total        Int      @default(0)
  observaciones        String   @default("")
  
  // ‚úÖ CAMPOS DE INSPECCI√ìN BOOLEAN
  gps                  Boolean  @default(false)
  pito                 Boolean  @default(false)
  freno                Boolean  @default(false)
  frenos               Boolean  @default(false)
  correas              Boolean  @default(false)
  espejos              Boolean  @default(false)
  parqueo              Boolean  @default(false)
  puertas              Boolean  @default(false)
  vidrios              Boolean  @default(false)
  baterias             Boolean  @default(false)
  tapiceria            Boolean  @default(false)
  cinturones           Boolean  @default(false)
  orden_aseo           Boolean  @default(false)
  suspension           Boolean  @default(false)
  altas_bajas          Boolean  @default(false)
  horas_sueno          Boolean  @default(false)
  indicadores          Boolean  @default(false)
  tapa_tanque          Boolean  @default(false)
  aceite_motor         Boolean  @default(false)
  libre_fatiga         Boolean  @default(false)
  direccionales        Boolean  @default(false)
  documentacion        Boolean  @default(false)
  fluido_frenos        Boolean  @default(false)
  kit_ambiental        Boolean  @default(false)
  limpia_brisas        Boolean  @default(false)
  
  // üîç CAMPOS DE ESTADO
  espejos_estado       String   @default("BUENO")
  
  // ‚è∞ CAMPOS DE AUDITOR√çA
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  // üîó RELACIONES
  historial_conductores historial_conductores[]

  // üìä √çNDICES PARA PERFORMANCE
  @@index([placa_vehiculo])
  @@index([contrato])
  @@index([fecha])
  @@index([marca_temporal])
}

model archivos_procesados {
  id                    String   @id @default(cuid())
  nombre_archivo        String
  hash_archivo          String   @unique
  tamano_archivo        Int?
  total_registros       Int      @default(0)
  registros_insertados  Int      @default(0)
  registros_duplicados  Int      @default(0)
  registros_error       Int      @default(0)
  ano_detectado         Int?
  tiempo_procesamiento  Float?
  errores_validacion    Json?
  advertencias          Json?
  fecha_procesamiento   DateTime @default(now())
  usuario_carga         String?
  estado                String   @default("PROCESADO") // PROCESADO, ERROR, REVERTIDO, CON_ERRORES

  @@index([ano_detectado])
  @@index([fecha_procesamiento])
}

model historial_conductores {
  id           String   @id @default(cuid())
  inspeccionId String
  
  inspeccion   inspecciones @relation(fields: [inspeccionId], references: [id], onDelete: Cascade)
}