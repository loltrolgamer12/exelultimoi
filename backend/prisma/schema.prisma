// üìÑ ARCHIVO: backend/prisma/schema.prisma
// üîß ESQUEMA COMPLETO CON TODOS LOS CAMPOS DE FATIGA Y VEH√çCULO

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model inspecciones {
  id                   String   @id @default(cuid())
  
  // üéØ CAMPOS OBLIGATORIOS
  placa_vehiculo       String   // ‚ö†Ô∏è NO PUEDE SER NULL
  contrato             String   // ‚ö†Ô∏è NO PUEDE SER NULL  
  turno                String   // ‚ö†Ô∏è NO PUEDE SER NULL
  conductor_nombre     String   @default("")
  fecha                DateTime @default(now())
  
  // üìä CAMPOS DE CONTEXTO
  campo_coordinacion   String   @default("")
  kilometraje          Int      @default(0)
  marca_temporal       BigInt   @default(0)
  
  // üö® CAMPOS DE FATIGA DEL CONDUCTOR (CR√çTICOS - AGREGADOS)
  consumo_medicamentos      Boolean  @default(false)  // ¬øHa consumido medicamentos?
  horas_sueno_suficientes   Boolean  @default(true)   // ¬øHa dormido al menos 7 horas?
  libre_sintomas_fatiga     Boolean  @default(true)   // ¬øLibre de s√≠ntomas fatiga?
  condiciones_aptas         Boolean  @default(true)   // ¬øEn condiciones para conducir?
  
  // ‚úÖ CAMPOS DE INSPECCI√ìN VEHICULAR
  altas_bajas          Boolean  @default(false)  // ** ALTAS Y BAJAS
  direccionales        Boolean  @default(false)  // DIRECCIONALES DERECHA E IZQUIERDA
  parqueo              Boolean  @default(false)  // **DE PARQUEO
  freno                Boolean  @default(false)  // **DE FRENO
  frenos               Boolean  @default(false)  // **FRENOS
  espejos              Boolean  @default(false)  // **ESPEJO CENTRAL Y LATERALES
  vidrios              Boolean  @default(false)  // **VIDRIO FRONTAL
  orden_aseo           Boolean  @default(false)  // PRESENTACI√ìN DE ORDEN Y ASEO
  pito                 Boolean  @default(false)  // PITO
  gps                  Boolean  @default(false)  // SISTEMA DE MONITOREO GPS
  frenos_emergencia    Boolean  @default(false)  // **FRENOS DE EMERGENCIA O DE MANO
  cinturones           Boolean  @default(false)  // **CINTURONES DE SEGURIDAD
  puertas              Boolean  @default(false)  // PUERTAS EN BUEN ESTADO
  vidrios_estado       Boolean  @default(false)  // VIDRIOS EN BUEN ESTADO
  limpia_brisas        Boolean  @default(false)  // **LIMPIA BRISAS
  extintor_vigente     Boolean  @default(false)  // EXTINTOR VIGENTE
  botiquin_completo    Boolean  @default(false)  // BOTIQU√çN
  tapiceria            Boolean  @default(false)  // ESTADO GENERAL DE TAPICER√çA
  indicadores          Boolean  @default(false)  // Indicadores (combustible, temp, etc)
  
  // üîß CAMPOS DE FLUIDOS Y MEC√ÅNICA
  aceite_motor         Boolean  @default(false)  // **NIVELES DE FLUIDOS ACEITE MOTOR
  fluido_frenos        Boolean  @default(false)  // **NIVELES DE FLUIDO DE FRENOS
  fluido_direccion     Boolean  @default(false)  // **FLUIDO DE DIRECCI√ìN HIDR√ÅULICA
  fluido_refrigerante  Boolean  @default(false)  // **FLUIDO REFRIGERANTE
  fluido_limpiabrisas  Boolean  @default(false)  // FLUIDO LIMPIA PARABRISAS
  correas              Boolean  @default(false)  // ESTADO DE CORREAS
  baterias             Boolean  @default(false)  // ESTADO DE BATER√çAS, CABLES, CONEXIONES
  
  // üöó CAMPOS DE LLANTAS Y SUSPENSI√ìN
  llantas_labrado      Boolean  @default(false)  // **LLANTAS - LABRADO (min 2mm)
  llantas_cortaduras   Boolean  @default(false)  // **LLANTAS - SIN CORTADURAS
  llanta_repuesto      Boolean  @default(false)  // LLANTA DE REPUESTO
  copas_pernos         Boolean  @default(false)  // **COPAS O PERNOS DE SUJECI√ìN
  suspension           Boolean  @default(false)  // **SUSPENSI√ìN (TERMINALES)
  direccion            Boolean  @default(false)  // **DIRECCI√ìN (TERMINALES)
  
  // üìã CAMPOS DE EQUIPAMIENTO
  tapa_tanque          Boolean  @default(false)  // Tapa de tanque de combustible
  kit_carretera        Boolean  @default(false)  // Equipo de carretera completo
  kit_ambiental        Boolean  @default(false)  // Kit ambiental
  documentacion        Boolean  @default(false)  // Documentaci√≥n completa
  
  // üöó OBSERVACIONES DEL VEH√çCULO (NO del conductor)
  observaciones        String   @default("")  // Problemas del veh√≠culo
  
  // üìä CAMPOS CALCULADOS
  nivel_riesgo         String   @default("BAJO")
  puntaje_total        Int      @default(0)
  puntaje_fatiga       Int      @default(0)        // Puntaje espec√≠fico de fatiga
  tiene_alertas_criticas Boolean @default(false)   // Para medicamentos u otros cr√≠ticos
  
  // ‚è∞ CAMPOS DE AUDITOR√çA
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  // üîó RELACIONES
  historial_conductores historial_conductores[]

  // üìä √çNDICES PARA PERFORMANCE
  @@index([placa_vehiculo])
  @@index([contrato])
  @@index([fecha])
  @@index([conductor_nombre])
  @@index([consumo_medicamentos])
  @@index([tiene_alertas_criticas])
  @@index([marca_temporal])
}

model archivos_procesados {
  id                    String   @id @default(cuid())
  nombre_archivo        String
  hash_archivo          String   @unique
  tamano_archivo        Int?
  total_registros       Int      @default(0)
  registros_insertados  Int      @default(0)
  registros_duplicados  Int      @default(0)
  registros_error       Int      @default(0)
  ano_detectado         Int?
  tiempo_procesamiento  Float?
  errores_validacion    Json?
  advertencias          Json?
  fecha_procesamiento   DateTime @default(now())
  usuario_carga         String?
  estado                String   @default("PROCESADO")

  @@index([ano_detectado])
  @@index([fecha_procesamiento])
  @@index([hash_archivo])
}

model historial_conductores {
  id           String   @id @default(cuid())
  inspeccionId String
  
  inspeccion   inspecciones @relation(fields: [inspeccionId], references: [id], onDelete: Cascade)
}